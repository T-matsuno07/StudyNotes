gitの戻す系操作

# 最後にコミットした状態に戻す

ワークツリーやインデックスの状態を最後にコミットした状態に戻す。

git cloneした状態にまで戻すコマンド以下の通り
```git
git reset --hard
git clean -dfx
```

- `git reset --hard` は追跡ファイルを元の状態に戻すコマンド
- `git clean -dfx` は全ての非追跡ファイルを削除するコマンド

# gitの操作 取り消し: git reset

`git add`や`git commit`の操作を取り消す操作が`git reset`である。

git reset系の操作を記載する

```bash
git reset [モード] [コミットID]
```

## commit操作を取り消す

```bash
git reset --soft [コミットID]
```

最も影響の少ないオプションで、指定したコミットにHEADを変更(戻す)だけ。  
上記のコマンドだと、HEADを一つ前のコミットに戻す。  
直近のcommit操作のみ取り消す効果であり、 addコマンドを実行した後の状態に戻る。  
無論、ファイルの変更状態は保持される。

## add & commit 操作を取り消す

```bash
git reset  [コミットID]
```
HEADを指定したコミットに変更し、インデックスも指定したコミットの状態に戻す。  
HEADとインデックスを一つ目の状態に戻す効果がある。  
直近のcommitとaddコマンドを取り消す効果があるため、commitした後に、ファイルの編集を追加してコミットしなおしたい時に使える。  
インデックスの状態を元に戻す特徴を利用し、addコマンドを全取り消しするのに使える。

## ファイル修正 & add & commit 操作を取り消す

```bash
git reset --hard [コミットID]
```

最もresetによる影響範囲が広いコマンドであり、「コミット(commit)・ステージング(add)・ファイルの編集」を全て取り消す。  
一つ前のコミットの状態まで完全に戻すことが出来るコマンド。  
非常に強力なコマンドであるが、ファイルの編集(ワーキングツリー)の内容まで削除するため、使用する際には最新の注意を払うこと。  


# 非追跡ファイル一括削除:git clean
git resetコマンドは、追跡ファイルを元の状態へ戻すコマンドであり、非追跡ファイルへの影響を与えない。  
非追跡ファイルを削除(元の状態に戻す)するコマンドはgit cleanを用いる。

## git clean 手順
```bash
# 非追跡ファイル一括削除実行前に削除対象ファイルを確認
git clean -dfx -n
# # 非追跡ファイル一括削除を実行する
git clean -dfx
```

-xや-Xオプションによってgitignoreで無視しているファイルに対する挙動が変化する

| オプション |  機能 |
| --- | --- |
| x系なし | 無視しているファイルは削除対象に含まない |
| -x | 無視しているファイルも削除する |
| -X | 無視しているファイルのみを削除する |


## git clean オプション
| オプション |  機能 |
| --- | --- |
| -d |  ディレクトリを削除対象に含める。 |
| -f |  ファイル削除を強制的に実行する。 |
| -i |  インタラクティブモードでファイルを削除する。 |
| -n |  ドライラン。ファイルは削除せず、「このコマンドを実行すれば何が削除されるのか」を示すだけ。 |
| -q |  どのファイルが削除されたかは表示せずエラーのみを表示する。 |
| -e |  対象外のファイルのパターンを指定する。 |
| -x |  .gitignore や $GIT_DIR/info/exclude で指定されているファイルを除外せず削除対象に含める。 |
| -X  |  Git が ignore しているファイルのみを削除対象とする。 |


# 直近のコミットを修正 git commit --amend
実行したコミットの内容を修正したい時には、`git commit --amend`を使用する

コミットメッセージを修正したい時には、インデックスが空の状態でamendコマンドを実行する
```bash
git commit --amend -m "コミットメッセージ"
```

コミットした後にadd漏れに気付いた時には、git addを実行した直後にamendコマンドを実行する。  
この際に--no-editオプションを付けると、コミットメッセージは変更せずにそのまま流用できる。

```bash
git add [ファイル]
git commit --amend --no-edit
```
